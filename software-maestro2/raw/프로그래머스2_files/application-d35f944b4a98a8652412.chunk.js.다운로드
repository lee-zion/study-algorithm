(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{1067:function(e,t,s){"use strict";var n=s(2299);t.a=Object(n.createConsumer)()},217:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return o}));const n=new Map([["alarm_chat.mp3",()=>s.e(270).then(s.t.bind(null,1245,7))],["alarm_notification.mp3",()=>s.e(271).then(s.t.bind(null,1246,7))]]);async function a(e){if(!n.has(e))throw new Error(`Audio filename "${e}" not found`);const t=n.get(e);if(t instanceof Audio)return t;if("function"===typeof t){const{default:s}=await t(),a=new Audio(s);return await new Promise(((e,t)=>(a.addEventListener("canplaythrough",e),a.addEventListener("error",t)))),n.set(e,a),a}throw new Error(`Audio filename "${e}" is invalid`)}async function o(e){const t=await a(e);try{await(null===t||void 0===t?void 0:t.play())}catch(s){if(s instanceof Error&&"NotAllowedError"!==s.name)throw s}return t}},2922:function(e,t,s){const n=s(2923);n.keys().forEach(n)},2923:function(e,t){function s(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}s.keys=function(){return[]},s.resolve=s,e.exports=s,s.id=2923},2924:function(e,t,s){var n={"./chat_controller.js":2925,"./chat_notification_proctor_controller.js":2926,"./chat_notification_testee_controller.js":2927,"./chat_room_controller.js":2928,"./essay_submission_controller.js":2929,"./inquiries_controller.js":2930,"./score_filter_controller.ts":2931,"./xlsx_downloader_controller.js":3428};function a(e){var t=o(e);return s(t)}function o(e){if(!s.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}a.keys=function(){return Object.keys(n)},a.resolve=o,e.exports=a,a.id=2924},2925:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return c}));var n=s(12),a=s.n(n),o=s(504),r=s(217),i=s(1067);class c extends o.b{connect(){console.log(`chat channel connect ${this.data.get("test-token-id")}`),this.channel=i.a.subscriptions.create({channel:"ChatChannel",id:this.data.get("test-token-id")},{connected:this.connected.bind(this),received:this.received.bind(this)}),this.disableSubmitIfEmpty(),this.removeChatOthersClassForMyMessage()}disconnect(){console.log(`chat channel DISCONNECT ${this.data.get("test-token-id")}`),this.channel.unsubscribe()}received(e){const t=$(e.html);$(this.ulTarget).append(t),this.hasHelpMessageTarget&&$(this.helpMessageTarget).remove(),this.removeChatOthersClassForMyMessage(),this.channel.perform("mark",{test_token_id:this.data.get("test-token-id"),message_id:e.message.id,user_type:this.data.get("user-type")}),document.hidden&&t.hasClass("chat-other-party")&&Object(r.b)("alarm_chat.mp3")}connected(){this.channel.perform("mark",{test_token_id:this.data.get("test-token-id"),message_id:$(this.ulTarget).find("li:last-of-type").data("message-id"),user_type:this.data.get("user-type")})}removeChatOthersClassForMyMessage(){$(this.ulTarget).find(`li[data-userable='${this.data.get("userable")}']`).removeClass("chat-other-party"),$(this.ulTarget).scrollTop($(this.ulTarget)[0].scrollHeight)}disableSubmitIfEmpty(){$(this.formTarget).find("button[type=submit]").attr("disabled",!0),$(this.formTarget).find("#chat_message_message").keyup(function(e){""==$(e.target).val().trim()?$(this.formTarget).find("button[type=submit]").attr("disabled",!0):$(this.formTarget).find("button[type=submit]").attr("disabled",!1)}.bind(this))}}a()(c,"targets",["ul","form","helpMessage"])},2926:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return i}));var n=s(12),a=s.n(n),o=s(504),r=s(1067);class i extends o.b{connect(){this.channel=r.a.subscriptions.create({channel:"ChatNotificationProctorChannel",test:this.data.get("test-id"),user:this.data.get("user")},{connected:this.connected.bind(this),received:this.received.bind(this)})}disconnect(){this.channel.unsubscribe()}received(e){this.element.querySelectorAll(`[data-chat-test-token-id='${e.test_token_id}']`)[0];const t=0!=$(`#chat-list-${e.test_token_id}`).length;switch(e.type){case"new_message":t||($(this.tabTarget).addClass("new"),$(`#chat-${e.test_token_id}`).addClass("new"),$(`#chat-${e.test_token_id}`).find("h6.chat-list-item__last-message--data").html(e.message),$(`#chat-${e.test_token_id}`).find("span.chat-list-item__last-message--time").html(e.time));break;case"clear_new_message":$(this.tabTarget).removeClass("new")}}connected(){}}a()(i,"targets",["tab"])},2927:function(e,t,s){"use strict";s.r(t);var n=s(504),a=s(1067);t.default=class extends n.b{connect(){console.log(`connect ChatNotificationTestee ${this.data.get("test-token-id")}`),this.channel=a.a.subscriptions.create({channel:"ChatNotificationTesteeChannel",token:this.data.get("token"),time:(new Date).toString()},{connected:this.connected.bind(this),received:this.received.bind(this)})}disconnect(){this.channel.unsubscribe()}received(e){const t=$(`#chat-list-${e.test_token_id}`).length;if("new_message"===e.type)t||$.get({url:`/tests/${e.test_id}/chat_rooms/dialog`})}connected(){}}},2928:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return r}));var n=s(12),a=s.n(n),o=s(504);class r extends o.b{addChatRooms(e){e.preventDefault();const t=this.applicantsTarget.value;let s=!0,n={};const a=/^(\d+)$/,o=/^(\d+)-(\d+)$/;if(a.test(t)){n={offset:t.match(a)[1],limit:1}}else if(o.test(t)){let e=t.match(o);e=e.map((e=>parseInt(e))).sort(((e,t)=>e-t)),s=e[1]<e[2],n={offset:e[1],limit:e[2]-e[1]+1}}else if(/^(\d+)(, ?\d+?)*$/.test(t)){let e=t.match(/\d+/g);e=e.map((e=>parseInt(e))).sort(((e,t)=>e-t)),n={offsets:e}}else s=!1;s&&$.ajax({type:"POST",url:$("#form-chat-add").attr("action"),data:n})}}a()(r,"targets",["applicants"])},2929:function(e,t,s){"use strict";s.r(t);var n=s(504);t.default=class extends n.b{copy(){const e=$("<textarea></textarea>");$("body").append(e),e.val($("#js-content").val()).select(),document.execCommand("copy"),Hera.utils.snackbar(I18n.t("copied")),e.remove()}}},2930:function(e,t,s){"use strict";s.r(t);var n=s(12),a=s.n(n),o=s(40),r=s.n(o),i=s(504);t.default=class extends i.b{constructor(...e){super(...e),a()(this,"phoneRegex",/\d{2,3}-\d{3,4}-\d{4}/),a()(this,"onKeyup",r.a.debounce(this._handleKeyup,500))}connect(){const e=document.getElementById("inquiry-terms");this._handleSubmitButton(!e.checked)}onChangeInquiryTerm(e){this._handleSubmitButton(!e.target.checked)}_handleSubmitButton(e){document.getElementById("inquiry-submit-button").disabled=e}_setError(e,t){const s=e.querySelector(".help-block");e.classList[t?"remove":"add"]("has-error"),s.classList[t?"add":"remove"]("hidden")}_handleKeyup(e){const{value:t,name:s}=e.target;this._setError(e.target.closest(".form-group"),"inquiry[email]"===s?Hera.commons.validateEmail(t):this.phoneRegex.test(t))}}},2931:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return i}));var n=s(12),a=s.n(n),o=s(504);const r={filtered:!1,score:0};class i extends o.b{connect(){this.handleReset()}handleChange(){const{scoreFormTarget:e}=this,{scoreFilter:t,scoreValue:s}=e,n="true"===t.value,{classList:a}=this.scoreContainerTarget;n?(a.remove("hidden"),s.focus()):a.add("hidden")}async handleClose(){this.handleReset(),await new Promise(requestAnimationFrame),$(this.element).dropdown("toggle").dropdown("dispose")}handleKeyup(e){"Enter"===e.key&&this.handleSave()}handleReset(){const[e,t]=[r.filtered,r.score].map(String),{scoreFilter:s,scoreValue:n}=this.scoreFormTarget;s.value!==e&&(s.value=e,this.handleChange()),n.value!==t&&(n.value=t)}async handleSave(){const{scoreFilter:e,scoreValue:t}=this.scoreFormTarget,[s,n]=["true"===e.value,+t.value];r.filtered!==s&&(r.filtered=s),r.score!==n&&(r.score=n),this.scoreCloseTarget.click(),await Hera.tryouts.updateTryoutTokens(),this.commitScoreFilterButton()}handleSubmit(e){e.preventDefault()}commitScoreFilterButton(){const e=document.getElementById("score-filter-button-text"),t=r.filtered&&r.score>0&&[r.score,I18n.t("tryouts.show.score_filter.greater_than")].join(" ")||I18n.t("tryouts.show.score_filter.all");Object.assign(e,{textContent:t})}}a()(i,"targets",["scoreClose","scoreContainer","scoreForm"])},3427:function(e,t,s){"use strict";s.r(t);var n=s(504),a=s(2328);const o=n.a.start(),r=s(2924);o.load(Object(a.a)(r)),s(2922),console.log("Application.js")},3428:function(e,t,s){"use strict";s.r(t);var n=s(504);t.default=class extends n.b{async handleClick(e){const t=e.currentTarget,{endpoint:n,progressModalText:a}=t.dataset;try{this.showProgressModal(a);const e=await fetch(n),t=this.getFilename(e);!async function(e,t){const{default:n}=await Promise.all([s.e(2),s.e(50),s.e(175)]).then(s.t.bind(null,278,7)),a=n.read(t,{type:"string",raw:!0});n.writeFile(a,`${e}.xlsx`)}(t,await e.text())}catch{this.showSnackBar(I18n.t("excel_download.error"))}finally{this.hideProgressModal()}}getFilename(e){const t=e.headers.get("Content-Disposition").split(";")[1].split("filename=")[1].slice(1,-1);return decodeURIComponent(atob(t))}showProgressModal(e){"undefined"!==typeof Hera&&Hera.commons.progressModal.show(e)}hideProgressModal(){"undefined"!==typeof Hera&&Hera.commons.progressModal.hide()}showSnackBar(e){"undefined"!==typeof Hera&&Hera.utils.snackbar(e)}}}},[[3427,127,1,147]]]);
//# sourceMappingURL=application-d35f944b4a98a8652412.chunk.js.map